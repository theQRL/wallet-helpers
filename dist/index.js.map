{"version":3,"file":"index.js","names":["sha256","require","isEqual","v3Wallet","hexToBytes","hex","bytes","c","length","push","parseInt","substr","bytesToHex","i","toString","join","hashPKandformat","ePK","h","doConvert","a","qx","qm","slice","isArrayOfInts","arr","result","forEach","element","checkWeightsAndThreshold","threshold","error","sum","reduce","accumulator","currentValue","getWalletFileType","wallet","webWallet","pythonNode","convertedWebWallet","Object","keys","Array","isWalletFileDeprecated","encrypted","addressB32","pk","pythonNodeToWebWallet","output","addresses","e","module","exports","version","QRLAddressFromEPKHex","undefined","Error","json","password","newWallet"],"sources":["../src/index.js"],"sourcesContent":["var sha256 = require('js-sha256')\nvar isEqual = require('lodash.isequal')\nvar v3Wallet = require('./v3wallet').v3Wallet\n\nfunction hexToBytes(hex) {\n  for (var bytes = [], c = 0; c < hex.length; c += 2)\n    bytes.push(parseInt(hex.substr(c, 2), 16))\n  return bytes\n}\n\nfunction bytesToHex(bytes) {\n  for (var hex = [], i = 0; i < bytes.length; i++) {\n    hex.push((bytes[i] >>> 4).toString(16))\n    hex.push((bytes[i] & 0xf).toString(16))\n  }\n  return hex.join('')\n}\n\nfunction hashPKandformat(ePK) {\n  var h = hexToBytes(ePK)\n  return sha256(h)\n}\n\nfunction doConvert(ePK) {\n  var a = hashPKandformat(ePK)\n  var qx = sha256(hexToBytes('000400' + a))\n  var qm = qx.slice(56, 64)\n  return 'Q' + bytesToHex([0, 4, 0]) + a + qm\n}\n\nfunction isArrayOfInts(arr) {\n  var result = 0\n  arr.forEach(function(element) {\n    if (element === parseInt(element, 10)) {\n      result += 1\n    }\n  })\n  if (result === arr.length) {\n    return true\n  }\n  return false\n}\n\nfunction checkWeightsAndThreshold(arr, threshold) {\n  // check length > 0\n  if (arr.length === 0) {\n    return {\n      result: false,\n      error: 'Array has length 0'\n    }\n  }\n  // check each element in array, then threshold, is an integer\n  if (!isArrayOfInts(arr)) {\n    return {\n      result: false,\n      error: 'Array has non-integer values'\n    }\n  }\n  if (threshold !== parseInt(threshold, 10)) {\n    return {\n      result: false,\n      error: 'Threshold is not an integer'\n    }\n  }\n  // check threshold can actually be reacher\n  var sum = arr.reduce(function(accumulator, currentValue) {\n    return accumulator + currentValue\n  })\n  if (threshold > sum) {\n    return {\n      result: false,\n      error: 'Threshold can never be reached with these weights'\n    }\n  }\n  return {\n    result: true\n  }\n}\n\nfunction getWalletFileType(wallet) {\n  // determines source of wallet file\n  const webWallet = ['address', 'addressB32', 'pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'encrypted']\n  const pythonNode = ['addresses', 'encrypted', 'version']\n  const convertedWebWallet = ['pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'address', 'encrypted']\n  if (isEqual(pythonNode, Object.keys(wallet))) {\n    return 'PYTHON-NODE'\n  }\n  if (wallet instanceof Array) {\n    if (isEqual(webWallet, Object.keys(wallet[0]))) {\n      return 'WEB-WALLET'\n    }\n    if (isEqual(convertedWebWallet, Object.keys(wallet[0]))) {\n      return 'CONVERTED-WEB-WALLET'\n    }\n  }\n  return 'UNKNOWN'\n}\n\nfunction isWalletFileDeprecated(wallet) {\n  if (getWalletFileType(wallet) === 'PYTHON-NODE') return true\n  // There are three characteristics that describe a deprecated encrypted wallet file\n  // 1: The encrypted field is true and\n  // 2: The addressB32 field is unencrypted and\n  // 3: The pk field is unencrypted.\n  // Whilst neither of these fields risk funds being lost, they do reveal a users public\n  // address if their wallet file is stolen. This is a privacy concern.\n  // We can determine if they are unencrypted by checking their lengths.\n  // If addressB32 field is 64 characters in length, and pk field is 134 characters in length.\n  if (\n    (typeof wallet[0].encrypted !== 'undefined') &&\n    (typeof wallet[0].addressB32 !== 'undefined') &&\n    (typeof wallet[0].pk !== 'undefined')) {\n    if (\n      (wallet[0].encrypted === true) &&\n      (wallet[0].addressB32.length === 64) &&\n      (wallet[0].pk.length === 134)) {\n      return true\n    }\n  }\n  return false\n}\n\n\nfunction pythonNodeToWebWallet(wallet) {\n  const output = []\n  wallet.addresses.forEach(element => {\n    const e = element\n    e.encrypted = wallet.encrypted\n    output.push(e)\n  })\n  return output\n}\n\nmodule.exports = {\n  /**\n   * Reports the current module version\n   * @return {string} version\n   */\n  version: function () {\n    return \"3.1.0\"\n  },\n  QRLAddressFromEPKHex: function (ePK) {\n    if (ePK === undefined) {\n      throw new Error(\"No ePK parameter\")\n    }\n    if (ePK.length !== 134) {\n      throw new Error(\"ePK length invalid\")\n    }\n    return doConvert(ePK)\n  },\n  checkWeightsAndThreshold: function (arr, threshold) {\n    if (arr === undefined || threshold === undefined) {\n      throw new Error(\"Missing parameter\")\n    }\n    return checkWeightsAndThreshold(arr, threshold)\n  },\n  isWalletFileDeprecated: function (wallet) {\n    if (wallet === undefined) {\n      throw new Error(\"Missing parameter\")\n    }\n    return isWalletFileDeprecated(wallet)\n  },\n  getWalletFileType: function (wallet) {\n    if (wallet === undefined) {\n      throw new Error(\"Missing parameter\")\n    }\n    return getWalletFileType(wallet)\n  },\n  pythonNodeToWebWallet: function (wallet) {\n    if (wallet === undefined) {\n      throw new Error(\"Missing parameter\")\n    }\n    return pythonNodeToWebWallet(wallet)\n  },\n  v3Wallet: function (json, encrypted, password) {\n    if (json === undefined || encrypted === undefined) {\n      throw new Error(\"Missing parameter\")\n    }\n    if (encrypted === true && password === undefined) {\n      throw new Error(\"Missing password\")\n    }\n    const newWallet = v3Wallet(json, encrypted, password)\n    return newWallet\n  },\n}\n"],"mappings":"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"}