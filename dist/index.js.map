{"version":3,"sources":["../src/index.js"],"names":["sha256","require","isEqual","hexToBytes","hex","bytes","c","length","push","parseInt","substr","bytesToHex","i","toString","join","hashPKandformat","ePK","h","doConvert","a","qx","qm","slice","isArrayOfInts","arr","result","forEach","element","checkWeightsAndThreshold","threshold","error","sum","reduce","accumulator","currentValue","getWalletFileType","wallet","webWallet","pythonNode","convertedWebWallet","Object","keys","Array","isWalletFileDeprecated","encrypted","addressB32","pk","pythonNodeToWebWallet","output","addresses","e","module","exports","version","QRLAddressFromEPKHex","undefined","Error"],"mappings":"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","sourcesContent":["var sha256 = require('js-sha256')\nvar isEqual = require('lodash.isequal')\n\nfunction hexToBytes(hex) {\n  for (var bytes = [], c = 0; c < hex.length; c += 2)\n    bytes.push(parseInt(hex.substr(c, 2), 16))\n  return bytes\n}\n\nfunction bytesToHex(bytes) {\n  for (var hex = [], i = 0; i < bytes.length; i++) {\n    hex.push((bytes[i] >>> 4).toString(16))\n    hex.push((bytes[i] & 0xf).toString(16))\n  }\n  return hex.join('')\n}\n\nfunction hashPKandformat(ePK) {\n  var h = hexToBytes(ePK)\n  return sha256(h)\n}\n\nfunction doConvert(ePK) {\n  var a = hashPKandformat(ePK)\n  var qx = sha256(hexToBytes('000400' + a))\n  var qm = qx.slice(56, 64)\n  return 'Q' + bytesToHex([0, 4, 0]) + a + qm\n}\n\nfunction isArrayOfInts(arr) {\n  var result = 0\n  arr.forEach(function(element) {\n    if (element === parseInt(element, 10)) {\n      result += 1\n    }\n  })\n  if (result === arr.length) {\n    return true\n  }\n  return false\n}\n\nfunction checkWeightsAndThreshold(arr, threshold) {\n  // check length > 0\n  if (arr.length === 0) {\n    return {\n      result: false,\n      error: 'Array has length 0'\n    }\n  }\n  // check each element in array, then threshold, is an integer\n  if (!isArrayOfInts(arr)) {\n    return {\n      result: false,\n      error: 'Array has non-integer values'\n    }\n  }\n  if (threshold !== parseInt(threshold, 10)) {\n    return {\n      result: false,\n      error: 'Threshold is not an integer'\n    }\n  }\n  // check threshold can actually be reacher\n  var sum = arr.reduce(function(accumulator, currentValue) {\n    return accumulator + currentValue\n  })\n  if (threshold > sum) {\n    return {\n      result: false,\n      error: 'Threshold can never be reached with these weights'\n    }\n  }\n  return {\n    result: true\n  }\n}\n\nfunction getWalletFileType(wallet) {\n  // determines source of wallet file\n  const webWallet = ['address', 'addressB32', 'pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'encrypted']\n  const pythonNode = ['addresses', 'encrypted', 'version']\n  const convertedWebWallet = ['pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'address', 'encrypted']\n  if (isEqual(pythonNode, Object.keys(wallet))) {\n    return 'PYTHON-NODE'\n  }\n  if (wallet instanceof Array) {\n    if (isEqual(webWallet, Object.keys(wallet[0]))) {\n      return 'WEB-WALLET'\n    }\n    if (isEqual(convertedWebWallet, Object.keys(wallet[0]))) {\n      return 'CONVERTED-WEB-WALLET'\n    }\n  }\n  return 'UNKNOWN'\n}\n\nfunction isWalletFileDeprecated(wallet) {\n  if (getWalletFileType(wallet) === 'PYTHON-NODE') return true\n  // There are three characteristics that describe a deprecated encrypted wallet file\n  // 1: The encrypted field is true and\n  // 2: The addressB32 field is unencrypted and\n  // 3: The pk field is unencrypted.\n  // Whilst neither of these fields risk funds being lost, they do reveal a users public\n  // address if their wallet file is stolen. This is a privacy concern.\n  // We can determine if they are unencrypted by checking their lengths.\n  // If addressB32 field is 64 characters in length, and pk field is 134 characters in length.\n  if (\n    (typeof wallet[0].encrypted !== 'undefined') &&\n    (typeof wallet[0].addressB32 !== 'undefined') &&\n    (typeof wallet[0].pk !== 'undefined')) {\n    if (\n      (wallet[0].encrypted === true) &&\n      (wallet[0].addressB32.length === 64) &&\n      (wallet[0].pk.length === 134)) {\n      return true\n    }\n  }\n  return false\n}\n\n\nfunction pythonNodeToWebWallet(wallet) {\n  const output = []\n  wallet.addresses.forEach(element => {\n    const e = element\n    e.encrypted = wallet.encrypted\n    output.push(e)\n  })\n  return output\n}\n\nmodule.exports = {\n  /**\n   * Reports the current module version\n   * @return {string} version\n   */\n  version: function() {\n    return '2.1.0'\n  },\n  QRLAddressFromEPKHex: function(ePK) {\n    if (ePK === undefined) {\n      throw new Error('No ePK parameter')\n    }\n    if (ePK.length !== 134) {\n      throw new Error('ePK length invalid')\n    }\n    return doConvert(ePK)\n  },\n  checkWeightsAndThreshold: function(arr, threshold) {\n    if (arr === undefined || threshold === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return checkWeightsAndThreshold(arr, threshold)\n  },\n  isWalletFileDeprecated: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return isWalletFileDeprecated(wallet)\n  },\n  getWalletFileType: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return getWalletFileType(wallet)\n  },\n  pythonNodeToWebWallet: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return pythonNodeToWebWallet(wallet)\n  },\n}\n"],"file":"index.js"}