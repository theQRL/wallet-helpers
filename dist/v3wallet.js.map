{"version":3,"file":"v3wallet.js","names":["crypto","require","encrypt","plainTextBuffer","key","iv","cipher","createCipheriv","encrypted","Buffer","concat","update","authTag","getAuthTag","decrypt","decipher","createDecipheriv","setAuthTag","walletDataEncrypt","text","walletPassword","from","toString","salt","randomBytes","KEY","scryptSync","N","IV","walletDataDecrypt","splitText","split","decrypted","module","exports","v3Wallet","json","password","wallets","JSON","parse","forEach","wallet","newWallet","mnemonic","hexseed","address","pk","version","push"],"sources":["../src/v3wallet.js"],"sourcesContent":["const crypto = require('crypto')\n/**\n * AES-256-GCM Encryption\n * @param  {Buffer} plainTextBuffer\n * @param  {Buffer} key\n * @param  {Buffer} iv\n * @returns {Object}\n */\nfunction encrypt(plainTextBuffer, key, iv) {\n  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv)\n  return {\n    encrypted: Buffer.concat([cipher.update(plainTextBuffer), cipher.final()]),\n    authTag: cipher.getAuthTag(),\n    iv,\n  }\n}\n\n/**\n * AES-256-GCM Decryption\n * @param {Buffer} encrypted\n * @param {Buffer} key\n * @param {Buffer} iv\n * @param {Buffer} authTag\n * @returns {Buffer}\n */\nfunction decrypt(encrypted, key, iv, authTag) {\n  const decipher = crypto\n    .createDecipheriv('aes-256-gcm', key, iv)\n    .setAuthTag(authTag)\n  return Buffer.concat([decipher.update(encrypted), decipher.final()])\n}\n\nfunction walletDataEncrypt(text, walletPassword) {\n  const plainTextBuffer = Buffer.from(text.toString('hex'))\n  const salt = crypto.randomBytes(32)\n  const KEY = crypto.scryptSync(walletPassword, salt, 32, { N: 1024 })\n  const IV = crypto.randomBytes(12) // 96 bits as per NIST SP 800-38D\n  const { encrypted, authTag } = encrypt(plainTextBuffer, KEY, IV)\n  return `${IV.toString('hex')}:${authTag.toString('hex')}:${salt.toString(\n    'hex'\n  )}:${encrypted.toString('hex')}`\n}\n\nfunction walletDataDecrypt(text, walletPassword) {\n  const splitText = text.split(':')\n  const IV = splitText[0]\n  const authTag = splitText[1]\n  const salt = splitText[2]\n  const encrypted = splitText[3]\n  const KEY = crypto.scryptSync(walletPassword, Buffer.from(salt, 'hex'), 32, {\n    N: 1024,\n  })\n  const decrypted = decrypt(\n    Buffer.from(encrypted, 'hex'),\n    KEY,\n    Buffer.from(IV, 'hex'),\n    Buffer.from(authTag, 'hex')\n  )\n  return decrypted.toString()\n}\n\nmodule.exports = {\n  v3Wallet: function (json, encrypted, password) {\n    const wallets = []\n    JSON.parse(json).forEach((wallet) => {\n      const newWallet = {\n          mnemonic: encrypted ? walletDataEncrypt(wallet.mnemonic, password) : wallet.mnemonic,\n          hexseed: encrypted ? walletDataEncrypt(wallet.hexseed, password) : wallet.hexseed,\n          address: encrypted ? walletDataEncrypt(wallet.address, password) : wallet.address,\n          pk: encrypted ? walletDataEncrypt(wallet.pk, password) : wallet.pk,\n          version: 3,\n          encrypted: true\n        }\n      wallets.push(newWallet)\n    })\n    return wallets\n  },\n  walletDataDecrypt: function(text, password) {\n    return walletDataDecrypt(text, password)\n  }\n}\n"],"mappings":"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"}