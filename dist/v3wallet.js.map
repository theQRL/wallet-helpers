{"version":3,"file":"v3wallet.js","names":["crypto","require","DEFAULT_SCRYPT_PARAMS","N","r","p","dkLen","saltLen","DEFAULT_ARGON2ID_PARAMS","memoryCost","timeCost","parallelism","hashLength","DEFAULT_IV_LEN","normalizeJsonInput","input","JSON","stringify","parse","scryptMaxMem","params","deriveKeyScrypt","password","salt","maxmem","scryptSync","deriveKeyArgon2","argon2","err","Error","hash","type","argon2id","raw","encryptAead","plainTextBuffer","key","iv","aad","cipher","createCipheriv","setAAD","encrypted","Buffer","concat","update","final","authTag","getAuthTag","decryptAead","decipher","createDecipheriv","setAuthTag","buildAad","meta","version","kdf","name","from","buildUnencryptedEnvelope","plainJson","data","buildEncryptedEnvelope","options","kdfOptions","kdfName","toLowerCase","Object","assign","randomBytes","ivLen","toString","buildEncryptedEnvelopeAsync","decryptEnvelopeSync","envelope","saltHex","decrypted","decryptEnvelopeAsync","legacyWalletDataEncrypt","text","walletPassword","KEY","IV","legacyWalletDataDecrypt","splitText","split","length","isLegacyV3Array","wallet","Array","isArray","mnemonic","hexseed","address","pk","undefined","decryptLegacyV3","wallets","map","normalizeEnvelopeInput","module","exports","v3Wallet","json","v3WalletAsync","v3WalletDecrypt","v3WalletDecryptAsync","walletDataDecrypt","walletDataEncrypt"],"sources":["../src/v3wallet.js"],"sourcesContent":["const crypto = require('crypto')\n\nconst DEFAULT_SCRYPT_PARAMS = {\n  N: 1 << 17,\n  r: 8,\n  p: 1,\n  dkLen: 32,\n  saltLen: 32,\n}\n\nconst DEFAULT_ARGON2ID_PARAMS = {\n  memoryCost: 65536,\n  timeCost: 3,\n  parallelism: 1,\n  hashLength: 32,\n  saltLen: 32,\n}\n\nconst DEFAULT_IV_LEN = 12\n\nfunction normalizeJsonInput(input) {\n  if (typeof input === 'string') {\n    return JSON.stringify(JSON.parse(input))\n  }\n  return JSON.stringify(input)\n}\n\nfunction scryptMaxMem(params) {\n  return 128 * params.r * (params.N + params.p + 2)\n}\n\nfunction deriveKeyScrypt(password, salt, params) {\n  const maxmem = params.maxmem || scryptMaxMem(params)\n  return crypto.scryptSync(password, salt, params.dkLen, {\n    N: params.N,\n    r: params.r,\n    p: params.p,\n    maxmem,\n  })\n}\n\nasync function deriveKeyArgon2(password, salt, params) {\n  let argon2\n  try {\n    argon2 = require('argon2')\n  } catch (err) {\n    throw new Error('argon2 dependency not installed')\n  }\n  return argon2.hash(password, {\n    type: argon2.argon2id,\n    memoryCost: params.memoryCost,\n    timeCost: params.timeCost,\n    parallelism: params.parallelism,\n    hashLength: params.hashLength,\n    salt,\n    raw: true,\n  })\n}\n\nfunction encryptAead(plainTextBuffer, key, iv, aad) {\n  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv)\n  if (aad) {\n    cipher.setAAD(aad)\n  }\n  return {\n    encrypted: Buffer.concat([cipher.update(plainTextBuffer), cipher.final()]),\n    authTag: cipher.getAuthTag(),\n  }\n}\n\nfunction decryptAead(encrypted, key, iv, authTag, aad) {\n  const decipher = crypto.createDecipheriv('aes-256-gcm', key, iv)\n  if (aad) {\n    decipher.setAAD(aad)\n  }\n  decipher.setAuthTag(authTag)\n  return Buffer.concat([decipher.update(encrypted), decipher.final()])\n}\n\nfunction buildAad(meta) {\n  const aad = {\n    version: meta.version,\n    kdf: meta.kdf,\n    cipher: {\n      name: meta.cipher.name,\n      iv: meta.cipher.iv,\n    },\n  }\n  return Buffer.from(JSON.stringify(aad), 'utf8')\n}\n\nfunction buildUnencryptedEnvelope(plainJson) {\n  return {\n    version: 3,\n    encrypted: false,\n    data: plainJson,\n  }\n}\n\nfunction buildEncryptedEnvelope(plainJson, password, options) {\n  const kdfOptions = options.kdf || {}\n  const kdfName = (kdfOptions.name || 'scrypt').toLowerCase()\n\n  if (kdfName !== 'scrypt') {\n    throw new Error('argon2id requires async API')\n  }\n\n  const params = Object.assign({}, DEFAULT_SCRYPT_PARAMS, kdfOptions.params || {})\n  const salt = crypto.randomBytes(params.saltLen)\n  const ivLen = options.ivLen || DEFAULT_IV_LEN\n  const iv = crypto.randomBytes(ivLen)\n\n  const key = deriveKeyScrypt(password, salt, params)\n\n  const meta = {\n    version: 3,\n    kdf: {\n      name: 'scrypt',\n      params: {\n        N: params.N,\n        r: params.r,\n        p: params.p,\n        dkLen: params.dkLen,\n        salt: salt.toString('hex'),\n      },\n    },\n    cipher: {\n      name: 'aes-256-gcm',\n      iv: iv.toString('hex'),\n    },\n  }\n\n  const aad = buildAad(meta)\n  const { encrypted, authTag } = encryptAead(\n    Buffer.from(plainJson, 'utf8'),\n    key,\n    iv,\n    aad\n  )\n\n  meta.cipher.authTag = authTag.toString('hex')\n\n  return {\n    version: 3,\n    encrypted: true,\n    kdf: meta.kdf,\n    cipher: meta.cipher,\n    data: encrypted.toString('hex'),\n  }\n}\n\nasync function buildEncryptedEnvelopeAsync(plainJson, password, options) {\n  const kdfOptions = options.kdf || {}\n  const kdfName = (kdfOptions.name || 'scrypt').toLowerCase()\n\n  if (kdfName !== 'scrypt' && kdfName !== 'argon2id') {\n    throw new Error('Unsupported KDF')\n  }\n\n  if (kdfName === 'scrypt') {\n    return buildEncryptedEnvelope(plainJson, password, options)\n  }\n\n  const params = Object.assign({}, DEFAULT_ARGON2ID_PARAMS, kdfOptions.params || {})\n  const salt = crypto.randomBytes(params.saltLen)\n  const ivLen = options.ivLen || DEFAULT_IV_LEN\n  const iv = crypto.randomBytes(ivLen)\n\n  const key = await deriveKeyArgon2(password, salt, params)\n\n  const meta = {\n    version: 3,\n    kdf: {\n      name: 'argon2id',\n      params: {\n        memoryCost: params.memoryCost,\n        timeCost: params.timeCost,\n        parallelism: params.parallelism,\n        hashLength: params.hashLength,\n        salt: salt.toString('hex'),\n      },\n    },\n    cipher: {\n      name: 'aes-256-gcm',\n      iv: iv.toString('hex'),\n    },\n  }\n\n  const aad = buildAad(meta)\n  const { encrypted, authTag } = encryptAead(\n    Buffer.from(plainJson, 'utf8'),\n    key,\n    iv,\n    aad\n  )\n\n  meta.cipher.authTag = authTag.toString('hex')\n\n  return {\n    version: 3,\n    encrypted: true,\n    kdf: meta.kdf,\n    cipher: meta.cipher,\n    data: encrypted.toString('hex'),\n  }\n}\n\nfunction decryptEnvelopeSync(envelope, password) {\n  if (!envelope.encrypted) {\n    return envelope.data\n  }\n  if (!password) {\n    throw new Error('Missing password')\n  }\n  if (!envelope.kdf || !envelope.cipher) {\n    throw new Error('Invalid wallet envelope')\n  }\n  if (envelope.kdf.name !== 'scrypt') {\n    throw new Error('argon2id requires async API')\n  }\n\n  const params = Object.assign({}, DEFAULT_SCRYPT_PARAMS, envelope.kdf.params || {})\n  const saltHex = params.salt\n  if (!saltHex) {\n    throw new Error('Missing scrypt salt')\n  }\n  const salt = Buffer.from(saltHex, 'hex')\n  delete params.salt\n\n  const key = deriveKeyScrypt(password, salt, params)\n  const iv = Buffer.from(envelope.cipher.iv, 'hex')\n  const authTag = Buffer.from(envelope.cipher.authTag, 'hex')\n  const aad = buildAad({\n    version: envelope.version,\n    kdf: envelope.kdf,\n    cipher: { name: envelope.cipher.name, iv: envelope.cipher.iv },\n  })\n\n  const decrypted = decryptAead(\n    Buffer.from(envelope.data, 'hex'),\n    key,\n    iv,\n    authTag,\n    aad\n  )\n  return decrypted.toString('utf8')\n}\n\nasync function decryptEnvelopeAsync(envelope, password) {\n  if (!envelope.encrypted) {\n    return envelope.data\n  }\n  if (!password) {\n    throw new Error('Missing password')\n  }\n  if (!envelope.kdf || !envelope.cipher) {\n    throw new Error('Invalid wallet envelope')\n  }\n\n  let key\n  switch (envelope.kdf.name) {\n    case 'scrypt': {\n      const params = Object.assign({}, DEFAULT_SCRYPT_PARAMS, envelope.kdf.params || {})\n      const saltHex = params.salt\n      if (!saltHex) {\n        throw new Error('Missing scrypt salt')\n      }\n      const salt = Buffer.from(saltHex, 'hex')\n      delete params.salt\n      key = deriveKeyScrypt(password, salt, params)\n      break\n    }\n    case 'argon2id': {\n      const params = Object.assign({}, DEFAULT_ARGON2ID_PARAMS, envelope.kdf.params || {})\n      const saltHex = params.salt\n      if (!saltHex) {\n        throw new Error('Missing argon2 salt')\n      }\n      const salt = Buffer.from(saltHex, 'hex')\n      delete params.salt\n      key = await deriveKeyArgon2(password, salt, params)\n      break\n    }\n    default:\n      throw new Error('Unsupported KDF')\n  }\n\n  const iv = Buffer.from(envelope.cipher.iv, 'hex')\n  const authTag = Buffer.from(envelope.cipher.authTag, 'hex')\n  const aad = buildAad({\n    version: envelope.version,\n    kdf: envelope.kdf,\n    cipher: { name: envelope.cipher.name, iv: envelope.cipher.iv },\n  })\n\n  const decrypted = decryptAead(\n    Buffer.from(envelope.data, 'hex'),\n    key,\n    iv,\n    authTag,\n    aad\n  )\n  return decrypted.toString('utf8')\n}\n\nfunction legacyWalletDataEncrypt(text, walletPassword) {\n  const plainTextBuffer = Buffer.from(text.toString('hex'))\n  const salt = crypto.randomBytes(32)\n  const KEY = crypto.scryptSync(walletPassword, salt, 32, { N: 1024 })\n  const IV = crypto.randomBytes(12)\n  const { encrypted, authTag } = encryptAead(plainTextBuffer, KEY, IV)\n  return `${IV.toString('hex')}:${authTag.toString('hex')}:${salt.toString(\n    'hex'\n  )}:${encrypted.toString('hex')}`\n}\n\nfunction legacyWalletDataDecrypt(text, walletPassword) {\n  const splitText = text.split(':')\n  if (splitText.length !== 4) {\n    throw new Error('Invalid legacy payload')\n  }\n  const IV = splitText[0]\n  const authTag = splitText[1]\n  const salt = splitText[2]\n  const encrypted = splitText[3]\n  const KEY = crypto.scryptSync(walletPassword, Buffer.from(salt, 'hex'), 32, {\n    N: 1024,\n  })\n  const decrypted = decryptAead(\n    Buffer.from(encrypted, 'hex'),\n    KEY,\n    Buffer.from(IV, 'hex'),\n    Buffer.from(authTag, 'hex')\n  )\n  return decrypted.toString()\n}\n\nfunction isLegacyV3Array(wallet) {\n  return Array.isArray(wallet)\n    && wallet.length > 0\n    && wallet[0]\n    && wallet[0].version === 3\n    && typeof wallet[0].mnemonic === 'string'\n    && typeof wallet[0].hexseed === 'string'\n    && typeof wallet[0].address === 'string'\n    && typeof wallet[0].pk === 'string'\n    && wallet[0].data === undefined\n}\n\nfunction decryptLegacyV3(wallets, password) {\n  return wallets.map((wallet) => {\n    if (!wallet.encrypted) {\n      return wallet\n    }\n    return Object.assign({}, wallet, {\n      mnemonic: legacyWalletDataDecrypt(wallet.mnemonic, password),\n      hexseed: legacyWalletDataDecrypt(wallet.hexseed, password),\n      address: legacyWalletDataDecrypt(wallet.address, password),\n      pk: legacyWalletDataDecrypt(wallet.pk, password),\n    })\n  })\n}\n\nfunction normalizeEnvelopeInput(input) {\n  if (typeof input === 'string') {\n    return JSON.parse(input)\n  }\n  return input\n}\n\nmodule.exports = {\n  v3Wallet: function (json, encrypted, password, options) {\n    if (json === undefined || encrypted === undefined) {\n      throw new Error('Missing parameter')\n    }\n    if (encrypted === true && password === undefined) {\n      throw new Error('Missing password')\n    }\n    const plainJson = normalizeJsonInput(json)\n    if (encrypted !== true) {\n      return buildUnencryptedEnvelope(plainJson)\n    }\n    return buildEncryptedEnvelope(plainJson, password, options || {})\n  },\n  v3WalletAsync: async function (json, encrypted, password, options) {\n    if (json === undefined || encrypted === undefined) {\n      throw new Error('Missing parameter')\n    }\n    if (encrypted === true && password === undefined) {\n      throw new Error('Missing password')\n    }\n    const plainJson = normalizeJsonInput(json)\n    if (encrypted !== true) {\n      return buildUnencryptedEnvelope(plainJson)\n    }\n    return buildEncryptedEnvelopeAsync(plainJson, password, options || {})\n  },\n  v3WalletDecrypt: function (input, password) {\n    if (input === undefined) {\n      throw new Error('Missing parameter')\n    }\n    const wallet = normalizeEnvelopeInput(input)\n    if (isLegacyV3Array(wallet)) {\n      return decryptLegacyV3(wallet, password)\n    }\n    const plainJson = decryptEnvelopeSync(wallet, password)\n    return JSON.parse(plainJson)\n  },\n  v3WalletDecryptAsync: async function (input, password) {\n    if (input === undefined) {\n      throw new Error('Missing parameter')\n    }\n    const wallet = normalizeEnvelopeInput(input)\n    if (isLegacyV3Array(wallet)) {\n      return decryptLegacyV3(wallet, password)\n    }\n    const plainJson = await decryptEnvelopeAsync(wallet, password)\n    return JSON.parse(plainJson)\n  },\n  walletDataDecrypt: function (text, password) {\n    return legacyWalletDataDecrypt(text, password)\n  },\n  walletDataEncrypt: function (text, password) {\n    return legacyWalletDataEncrypt(text, password)\n  },\n}\n"],"mappings":"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","ignoreList":[]}